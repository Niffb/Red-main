<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RED AI Settings - Manage your account, preferences, and integrations">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>RED AI - Settings</title>
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=20241216001">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        /* Settings-specific styles */
        .settings-main {
            margin-left: 280px;
            min-height: 100vh;
            background: var(--bg-primary);
            padding: 0;
        }

        .settings-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .settings-header {
            margin-bottom: 32px;
            padding: 24px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .settings-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }

        .settings-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 0;
        }

        .settings-grid {
            display: block;
        }

        .settings-navigation {
            display: none;
        }

        .settings-nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .settings-nav-item {
            display: block;
        }

        .settings-nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 400;
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 14px;
        }

        .settings-nav-link:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            text-decoration: none;
        }

        .settings-nav-link.active {
            background: var(--bg-dark);
            color: white;
        }

        .settings-nav-link.active:hover {
            background: var(--bg-dark);
            color: white;
        }

        .settings-nav-link svg {
            flex-shrink: 0;
            width: 18px;
            height: 18px;
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .panel-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .panel-description {
            color: var(--text-secondary);
            margin: 0;
            font-size: 0.9rem;
        }

        .settings-section {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px var(--shadow-light);
        }

        .section-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-light);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-size: 13px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-control:focus {
            border-color: var(--text-primary);
            box-shadow: none;
            background: var(--bg-primary);
        }

        .form-control::placeholder {
            color: var(--text-muted);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .form-toggle:last-child {
            border-bottom: none;
        }

        .toggle-info {
            flex: 1;
        }

        .toggle-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-size: 14px;
        }

        .toggle-description {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            outline: none;
        }

        .toggle-switch.active {
            background: var(--red-primary);
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch.active::before {
            transform: translateX(20px);
        }

        .btn-primary {
            background: var(--bg-dark);
            border: 1px solid var(--bg-dark);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .btn-primary:hover {
            background: var(--text-primary);
            border-color: var(--text-primary);
            color: white;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--border-dark);
        }

        .btn-danger {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        /* Danger Zone Styles */
        .danger-zone {
            border: 2px solid #fee2e2 !important;
            border-radius: 12px !important;
            padding: 24px !important;
            background: #fef2f2 !important;
            margin-top: 32px !important;
        }

        .danger-zone-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
            margin-top: 16px;
        }

        .danger-zone-info h4 {
            margin: 0 0 8px 0;
            font-weight: 600;
            color: #dc2626;
            font-size: 16px;
        }

        .danger-zone-info p {
            margin: 0;
            color: #991b1b;
            font-size: 14px;
            line-height: 1.5;
        }

        .btn-danger-outline {
            padding: 10px 20px;
            background: transparent;
            border: 2px solid #dc2626;
            color: #dc2626;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 14px;
        }

        .btn-danger-outline:hover {
            background: #dc2626;
            color: white;
        }

        /* Deletion Modal Styles */
        .deletion-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .deletion-modal {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-icon-warning {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            background: #fee2e2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .deletion-modal h2 {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            margin: 0 0 12px 0;
            text-align: center;
        }

        .deletion-modal p {
            font-size: 15px;
            color: #6b7280;
            line-height: 1.6;
            margin: 0 0 24px 0;
            text-align: center;
        }

        .confirmation-input-group {
            margin-bottom: 24px;
        }

        .confirmation-input-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .confirmation-input-group strong {
            color: #dc2626;
            font-weight: 700;
        }

        .confirmation-input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .confirmation-input-group input:focus {
            outline: none;
            border-color: #dc2626;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-actions button {
            flex: 1;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-actions .btn-secondary {
            background: #f3f4f6;
            border: none;
            color: #374151;
        }

        .modal-actions .btn-secondary:hover {
            background: #e5e7eb;
        }

        .modal-actions .btn-danger {
            background: #dc2626;
            border: none;
            color: white;
        }

        .modal-actions .btn-danger:hover:not(:disabled) {
            background: #b91c1c;
        }

        .modal-actions .btn-danger:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .danger-zone-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .btn-danger-outline {
                width: 100%;
            }
        }

        .btn-danger:hover {
            background: var(--bg-secondary);
            border-color: var(--border-dark);
            color: var(--text-secondary);
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 20px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-info {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .alert-warning {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .alert-danger {
            background: var(--red-light);
            border: 1px solid var(--red-primary);
            color: var(--red-primary);
        }

        .user-avatar-large {
            width: 80px;
            height: 80px;
            background: var(--bg-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px var(--shadow-medium);
        }

        .api-key-display {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px 16px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .api-key-text {
            flex: 1;
            word-break: break-all;
        }

        .copy-btn {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .usage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--red-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .settings-main {
                margin-left: 0;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .settings-navigation {
                position: static;
                order: -1;
                padding: 4px;
            }
            
            .settings-nav-list {
                flex-direction: row;
                overflow-x: auto;
                padding: 0;
                margin: 0;
                gap: 2px;
            }
            
            .settings-nav-item {
                flex-shrink: 0;
            }
            
            .settings-nav-link {
                white-space: nowrap;
                padding: 8px 12px;
            }
        }

        @media (max-width: 768px) {
            .settings-content {
                padding: 20px 16px;
            }
            
            .settings-title {
                font-size: 2rem;
            }
            
            .settings-section {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .usage-stats {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }
    </style>
</head>
<body class="loading">
    <!-- Sidebar Navigation -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-header">
            <a href="/" class="sidebar-logo">
                <img src="images/RED ICON.svg" alt="Red AI Logo" width="24" height="24">
                <span class="logo-text">Red AI</span>
            </a>
        </div>
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <svg width="20" height="20" viewBox="0 -0.5 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.25 9C20.25 8.58579 19.9142 8.25 19.5 8.25C19.0858 8.25 18.75 8.58579 18.75 9L20.25 9ZM11.5 18.25C11.0858 18.25 10.75 18.5858 10.75 19C10.75 19.4142 11.0858 19.75 11.5 19.75V18.25ZM18.75 9C18.75 9.41421 19.0858 9.75 19.5 9.75C19.9142 9.75 20.25 9.41421 20.25 9L18.75 9ZM11.5 4.25C11.0858 4.25 10.75 4.58579 10.75 5C10.75 5.41421 11.0858 5.75 11.5 5.75V4.25ZM19.5 9.75C19.9142 9.75 20.25 9.41421 20.25 9C20.25 8.58579 19.9142 8.25 19.5 8.25V9.75ZM11.5 8.25C11.0858 8.25 10.75 8.58579 10.75 9C10.75 9.41421 11.0858 9.75 11.5 9.75V8.25ZM6.25 12C6.25 11.5858 5.91421 11.25 5.5 11.25C5.08579 11.25 4.75 11.5858 4.75 12H6.25ZM11.5 19.75C11.9142 19.75 12.25 19.4142 12.25 19C12.25 18.5858 11.9142 18.25 11.5 18.25V19.75ZM4.75 12C4.75 12.4142 5.08579 12.75 5.5 12.75C5.91421 12.75 6.25 12.4142 6.25 12H4.75ZM11.5 5.75C11.9142 5.75 12.25 5.41421 12.25 5C12.25 4.58579 11.9142 4.25 11.5 4.25V5.75ZM5.5 11.25C5.08579 11.25 4.75 11.5858 4.75 12C4.75 12.4142 5.08579 12.75 5.5 12.75L5.5 11.25ZM11.5 12.75C11.9142 12.75 12.25 12.4142 12.25 12C12.25 11.5858 11.9142 11.25 11.5 11.25V12.75ZM12.25 12C12.25 11.5858 11.9142 11.25 11.5 11.25C11.0858 11.25 10.75 11.5858 10.75 12H12.25ZM10.75 19C10.75 19.4142 11.0858 19.75 11.5 19.75C11.9142 19.75 12.25 19.4142 12.25 19H10.75ZM10.75 12C10.75 12.4142 11.0858 12.75 11.5 12.75C11.9142 12.75 12.25 12.4142 12.25 12H10.75ZM12.25 9C12.25 8.58579 11.9142 8.25 11.5 8.25C11.0858 8.25 10.75 8.58579 10.75 9H12.25ZM12.25 5C12.25 4.58579 11.9142 4.25 11.5 4.25C11.0858 4.25 10.75 4.58579 10.75 5H12.25ZM10.75 9C10.75 9.41421 11.0858 9.75 11.5 9.75C11.9142 9.75 12.25 9.41421 12.25 9H10.75ZM18.75 9V15H20.25V9L18.75 9ZM18.75 15C18.75 16.7949 17.2949 18.25 15.5 18.25V19.75C18.1234 19.75 20.25 17.6234 20.25 15H18.75ZM15.5 18.25H11.5V19.75H15.5V18.25ZM20.25 9C20.25 6.37665 18.1234 4.25 15.5 4.25L15.5 5.75C17.2949 5.75 18.75 7.20507 18.75 9L20.25 9ZM15.5 4.25H11.5V5.75H15.5L15.5 4.25ZM19.5 8.25H11.5V9.75H19.5V8.25ZM4.75 12V15H6.25V12H4.75ZM4.75 15C4.75 17.6234 6.87665 19.75 9.5 19.75V18.25C7.70507 18.25 6.25 16.7949 6.25 15H4.75ZM9.5 19.75H11.5V18.25H9.5V19.75ZM6.25 12L6.25 9H4.75L4.75 12H6.25ZM6.25 9C6.25 7.20507 7.70507 5.75 9.5 5.75V4.25C6.87665 4.25 4.75 6.37665 4.75 9H6.25ZM9.5 5.75H11.5V4.25H9.5V5.75ZM5.5 12.75H11.5V11.25H5.5L5.5 12.75ZM10.75 12V19H12.25V12H10.75ZM12.25 12V9H10.75V12H12.25ZM10.75 5V9H12.25V5H10.75Z" fill="currentColor"/>
                        </svg>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/payment" class="nav-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <span>Plans & Upgrade</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="openBillingPortal(); return false;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                            <line x1="1" y1="10" x2="23" y2="10"/>
                        </svg>
                        <span>Billing & Invoices</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/settings.html" class="nav-link active">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        <span>Account Information</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info-card">
                <div class="user-info-avatar" id="sidebar-user-avatar">JD</div>
                <div class="user-info-name" id="sidebar-user-name">Loading...</div>
                <div class="user-info-email" id="sidebar-user-email">Loading...</div>
            </div>
            <button class="logout-btn" onclick="logout()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                <span>Logout</span>
            </button>
        </div>
    </aside>

    <!-- Settings Main Content -->
    <main class="settings-main">
        <div class="settings-content">
            <!-- Settings Header -->
            <div class="settings-header" data-aos="fade-up">
                <h1 class="settings-title">Settings</h1>
                <p class="settings-subtitle">Manage your account preferences and integrations</p>
            </div>

            <!-- Settings Grid -->
            <div class="settings-grid">
                <!-- Settings Panels -->
                <div class="settings-panels">
                    <!-- Profile Panel -->
                    <div class="settings-panel active" id="profile-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">Profile Information</h2>
                            <p class="panel-description">Update your personal information and profile settings</p>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                Personal Information
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 24px; margin-bottom: 24px;">
                                <div class="user-avatar-large" id="profile-avatar">JD</div>
                                <div>
                                    <button class="btn-secondary" style="margin-right: 8px;">Change Photo</button>
                                    <button class="btn-danger">Remove</button>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" placeholder="Loading..." id="first-name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" placeholder="Loading..." id="last-name">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" placeholder="Loading..." id="email" readonly>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Account Type</label>
                                <input type="text" class="form-control" id="auth-provider" readonly>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Member Since</label>
                                <input type="text" class="form-control" id="join-date" readonly>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Bio</label>
                                <textarea class="form-control" rows="3" placeholder="Tell us about yourself..."></textarea>
                            </div>

                            <div class="button-group">
                                <button class="btn-primary">Save Changes</button>
                                <button class="btn-secondary">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Account Panel -->
                    <div class="settings-panel" id="account-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">Account Information</h2>
                            <p class="panel-description">Manage your account security, preferences and data</p>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <circle cx="12" cy="16" r="1"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                                Security
                            </div>

                            <div class="form-group">
                                <label class="form-label">Current Password</label>
                                <input type="password" class="form-control" placeholder="Enter current password">
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label class="form-label">New Password</label>
                                    <input type="password" class="form-control" placeholder="Enter new password">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirm Password</label>
                                    <input type="password" class="form-control" placeholder="Confirm new password">
                                </div>
                            </div>

                            <div class="form-toggle">
                                <div class="toggle-info">
                                    <div class="toggle-title">Two-Factor Authentication</div>
                                    <div class="toggle-description">Add an extra layer of security to your account</div>
                                </div>
                                <button class="toggle-switch" onclick="toggleSwitch(this)"></button>
                            </div>

                            <div class="button-group">
                                <button class="btn-primary">Update Password</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v6.5l3 3L12 15V2z"/>
                                    <path d="M21 12H2"/>
                                    <path d="M3 21l18-18"/>
                                </svg>
                                Preferences
                            </div>

                            <div class="form-group">
                                <label class="form-label">Timezone</label>
                                <select class="form-control form-select">
                                    <option>UTC-08:00 (Pacific Time)</option>
                                    <option>UTC-05:00 (Eastern Time)</option>
                                    <option>UTC+00:00 (GMT)</option>
                                    <option>UTC+01:00 (Central European Time)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Language</label>
                                <select class="form-control form-select">
                                    <option>English</option>
                                    <option>Spanish</option>
                                    <option>French</option>
                                    <option>German</option>
                                </select>
                            </div>

                            <div class="button-group">
                                <button class="btn-primary">Save Preferences</button>
                            </div>
                        </div>

                        <!-- Danger Zone Section -->
                        <div class="settings-section danger-zone">
                            <div class="section-title" style="color: #ef4444;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                    <line x1="12" y1="9" x2="12" y2="13"/>
                                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                                </svg>
                                Danger Zone
                            </div>
                            
                            <div class="danger-zone-content">
                                <div class="danger-zone-info">
                                    <h4>Delete Account</h4>
                                    <p>Permanently delete your RED AI account and all associated data. This action cannot be undone.</p>
                                </div>
                                <button class="btn-danger-outline" onclick="confirmAccountDeletion()">
                                    Delete Account
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- API Keys Panel -->
                    <div class="settings-panel" id="api-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">API Keys</h2>
                            <p class="panel-description">Manage your API keys for integrations and automation</p>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <circle cx="12" cy="16" r="1"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                                Active API Keys
                            </div>

                            <div style="margin-bottom: 24px;">
                                <label class="form-label">Primary API Key</label>
                                <div class="api-key-display">
                                    <span class="api-key-text">red_sk_1234567890abcdef•••••••••••••••••••••••••••••••••••••••••</span>
                                    <button class="copy-btn" onclick="copyApiKey(this)">Copy</button>
                                </div>
                                <small style="color: var(--text-secondary); margin-top: 8px; display: block;">Created on March 15, 2024 • Last used 2 hours ago</small>
                            </div>

                            <div class="alert alert-info">
                                <strong>Keep your API keys secure!</strong> Don't share them in publicly accessible areas such as GitHub repositories or client-side code.
                            </div>

                            <div class="button-group">
                                <button class="btn-primary">Generate New Key</button>
                                <button class="btn-danger">Revoke Key</button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">Usage Statistics</div>
                            <div class="usage-stats">
                                <div class="stat-card">
                                    <div class="stat-value">24,851</div>
                                    <div class="stat-label">API Calls This Month</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">1.2GB</div>
                                    <div class="stat-label">Data Processed</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">99.9%</div>
                                    <div class="stat-label">Uptime</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Panel -->
                    <div class="settings-panel" id="notifications-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">Notification Preferences</h2>
                            <p class="panel-description">Choose how you want to receive notifications and updates</p>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                    <polyline points="22,6 12,13 2,6"/>
                                </svg>
                                Email Notifications
                            </div>

                            <div class="form-toggle">
                                <div class="toggle-info">
                                    <div class="toggle-title">Account Updates</div>
                                    <div class="toggle-description">Important updates about your account and security</div>
                                </div>
                                <button class="toggle-switch active" onclick="toggleSwitch(this)"></button>
                            </div>

                            <div class="form-toggle">
                                <div class="toggle-info">
                                    <div class="toggle-title">Usage Alerts</div>
                                    <div class="toggle-description">Notifications when you're approaching usage limits</div>
                                </div>
                                <button class="toggle-switch active" onclick="toggleSwitch(this)"></button>
                            </div>

                            <div class="form-toggle">
                                <div class="toggle-info">
                                    <div class="toggle-title">Product Updates</div>
                                    <div class="toggle-description">News about new features and improvements</div>
                                </div>
                                <button class="toggle-switch" onclick="toggleSwitch(this)"></button>
                            </div>

                            <div class="form-toggle">
                                <div class="toggle-info">
                                    <div class="toggle-title">Marketing</div>
                                    <div class="toggle-description">Tips, tutorials, and promotional content</div>
                                </div>
                                <button class="toggle-switch" onclick="toggleSwitch(this)"></button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                                </svg>
                                Push Notifications
                            </div>

                            <div class="form-toggle">
                                <div class="toggle-info">
                                    <div class="toggle-title">System Alerts</div>
                                    <div class="toggle-description">Critical system notifications and downtime alerts</div>
                                </div>
                                <button class="toggle-switch active" onclick="toggleSwitch(this)"></button>
                            </div>

                            <div class="form-toggle">
                                <div class="toggle-info">
                                    <div class="toggle-title">Task Completions</div>
                                    <div class="toggle-description">Notifications when your AI tasks complete</div>
                                </div>
                                <button class="toggle-switch active" onclick="toggleSwitch(this)"></button>
                            </div>

                            <div class="button-group">
                                <button class="btn-primary">Save Preferences</button>
                            </div>
                        </div>
                    </div>

                    <!-- Integrations Panel -->
                    <div class="settings-panel" id="integrations-panel">
                        <div class="panel-header">
                            <h2 class="panel-title">Integrations</h2>
                            <p class="panel-description">Connect RED AI with your favorite tools and services</p>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                                </svg>
                                Connected Apps
                            </div>

                            <div style="display: flex; flex-direction: column; gap: 16px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 40px; height: 40px; background: #4285f4; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">G</div>
                                        <div>
                                            <div style="font-weight: 500;">Google Workspace</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Connected • Access to Gmail, Drive, Calendar</div>
                                        </div>
                                    </div>
                                    <button class="btn-danger" style="font-size: 12px; padding: 8px 12px;">Disconnect</button>
                                </div>

                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 40px; height: 40px; background: #5865f2; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">D</div>
                                        <div>
                                            <div style="font-weight: 500;">Discord</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Ready to connect • Bot notifications and commands</div>
                                        </div>
                                    </div>
                                    <button class="btn-primary" style="font-size: 12px; padding: 8px 12px;">Connect</button>
                                </div>

                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 40px; height: 40px; background: #1da1f2; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">S</div>
                                        <div>
                                            <div style="font-weight: 500;">Slack</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">Ready to connect • Team notifications and workflows</div>
                                        </div>
                                    </div>
                                    <button class="btn-primary" style="font-size: 12px; padding: 8px 12px;">Connect</button>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="16 18 22 12 16 6"/>
                                    <polyline points="8 6 2 12 8 18"/>
                                </svg>
                                Webhooks
                            </div>

                            <div class="alert alert-info">
                                <strong>Webhook Integration</strong> Send real-time data to your applications when events occur in RED AI.
                            </div>

                            <div class="form-group">
                                <label class="form-label">Webhook URL</label>
                                <input type="url" class="form-control" placeholder="https://your-app.com/webhook">
                            </div>

                            <div class="button-group">
                                <button class="btn-primary">Add Webhook</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        // Initialize AOS
        document.addEventListener('DOMContentLoaded', function() {
            // Remove loading classes
            setTimeout(function() {
                document.documentElement.classList.remove('loading');
                document.body.classList.remove('loading');
            }, 100);
            
            // Initialize AOS
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    easing: "ease-out-cubic",
                    duration: 600,
                    once: true,
                    offset: 120,
                    delay: 0,
                    disable: false
                });
            }

            // Load user data
            loadUserData();

            // Handle settings dropdown toggle (for sidebar navigation)
            const settingsToggle = document.getElementById('settings-toggle');
            const settingsMiniNav = document.getElementById('settings-mini-nav');
            const settingsNavItem = document.getElementById('settings-nav-item');

            if (settingsToggle && settingsMiniNav) {
                settingsToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    settingsMiniNav.classList.toggle('active');
                    settingsNavItem.classList.toggle('settings-expanded');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!settingsNavItem.contains(e.target)) {
                        settingsMiniNav.classList.remove('active');
                        settingsNavItem.classList.remove('settings-expanded');
                    }
                });

                // Prevent dropdown from closing when clicking inside it
                settingsMiniNav.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });

        // Toggle switch functionality
        function toggleSwitch(element) {
            element.classList.toggle('active');
        }

        // Copy API key functionality
        function copyApiKey(button) {
            const apiKeyText = button.previousElementSibling.textContent;
            navigator.clipboard.writeText(apiKeyText).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = originalText;
                }, 2000);
            });
        }

        // Open Stripe Billing Portal
        async function openBillingPortal() {
            try {
                console.log('🔄 Opening billing portal...');
                
                const response = await fetch('/api/billing-portal', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin'
                });
                
                console.log('📡 Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('✅ Portal URL received:', data.url);
                    
                    if (data.url) {
                        window.location.href = data.url;
                    } else {
                        throw new Error('No portal URL returned');
                    }
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('❌ Error response:', errorData);
                    
                    // Handle free users gracefully
                    if (errorData.isFreeUser || (errorData.error && errorData.error.includes('Free plan'))) {
                        alert('Billing portal is only available for paid plans.\n\nYou are currently on the Free plan. Click "Plans & Upgrade" to upgrade.');
                    } else {
                        // Show the detailed error message
                        const errorMsg = errorData.details || errorData.error || 'Failed to open billing portal';
                        alert('Unable to open billing portal:\n\n' + errorMsg);
                    }
                }
            } catch (error) {
                console.error('❌ Billing portal error:', error);
                alert('Unable to open billing portal:\n\n' + error.message);
            }
        }
        
        // Logout function
        function logout() {
            window.location.href = '/api/logout';
        }

        // Confirm account deletion with modal
        function confirmAccountDeletion() {
            const modal = document.createElement('div');
            modal.className = 'deletion-modal-overlay';
            modal.innerHTML = `
                <div class="deletion-modal">
                    <div class="modal-icon-warning">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                    </div>
                    <h2>Delete Account?</h2>
                    <p>This will permanently delete your account, subscription, and all associated data. This action cannot be undone.</p>
                    
                    <div class="confirmation-input-group">
                        <label>Type <strong>DELETE</strong> to confirm:</label>
                        <input type="text" id="delete-confirmation-input" placeholder="Type DELETE" autocomplete="off" />
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn-secondary" onclick="closeDeletionModal()">Cancel</button>
                        <button class="btn-danger" id="confirm-delete-btn" disabled onclick="deleteAccount()">
                            Delete My Account
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Enable delete button only when user types "DELETE"
            const input = document.getElementById('delete-confirmation-input');
            const confirmBtn = document.getElementById('confirm-delete-btn');
            
            input.addEventListener('input', (e) => {
                confirmBtn.disabled = e.target.value !== 'DELETE';
            });

            // Close modal on escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeDeletionModal();
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);

            // Focus input
            setTimeout(() => input.focus(), 100);
        }

        function closeDeletionModal() {
            const modal = document.querySelector('.deletion-modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        async function deleteAccount() {
            const confirmBtn = document.getElementById('confirm-delete-btn');
            confirmBtn.disabled = true;
            confirmBtn.textContent = 'Deleting...';
            
            try {
                const response = await fetch('/api/user/delete-account', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'same-origin'
                });
                
                if (response.ok) {
                    alert('Your account has been successfully deleted. You will be logged out now.');
                    window.location.href = '/signin.html';
                } else {
                    const error = await response.json();
                    alert('Failed to delete account: ' + (error.error || 'Unknown error'));
                    confirmBtn.disabled = false;
                    confirmBtn.textContent = 'Delete My Account';
                }
            } catch (error) {
                console.error('Account deletion error:', error);
                alert('Error deleting account. Please try again or contact support.');
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'Delete My Account';
            }
        }

        // Load user data
        async function loadUserData() {
            try {
                const response = await fetch('/api/user');
                if (response.ok) {
                    const userData = await response.json();
                    populateUserData(userData);
                } else {
                    // Redirect to signin if not authenticated
                    window.location.href = '/signin';
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                // Use mock data for demo
                populateUserData({
                    name: 'John Doe',
                    email: 'john.doe@example.com',
                    firstName: 'John',
                    lastName: 'Doe'
                });
            }
        }

        // Populate user data in forms
        async function populateUserData(user) {
            // Update sidebar user info
            const sidebarAvatar = document.getElementById('sidebar-user-avatar');
            const sidebarName = document.getElementById('sidebar-user-name');
            const sidebarEmail = document.getElementById('sidebar-user-email');
            
            if (sidebarAvatar) sidebarAvatar.textContent = user.name.split(' ').map(n => n[0]).join('');
            if (sidebarName) sidebarName.textContent = user.name;
            if (sidebarEmail) sidebarEmail.textContent = user.email;

            // Update profile avatar
            const avatar = document.getElementById('profile-avatar');
            if (avatar) {
                avatar.textContent = user.name.split(' ').map(n => n[0]).join('');
            }

            // Update form fields - Personal Information
            const firstNameField = document.getElementById('first-name');
            const lastNameField = document.getElementById('last-name');
            const emailField = document.getElementById('email');
            const authProviderField = document.getElementById('auth-provider');
            const joinDateField = document.getElementById('join-date');

            if (firstNameField) firstNameField.value = user.firstName || user.name.split(' ')[0] || '';
            if (lastNameField) lastNameField.value = user.lastName || user.name.split(' ')[1] || '';
            if (emailField) emailField.value = user.email || '';
            
            // Auth provider
            if (authProviderField) {
                const provider = user.authProvider === 'google' ? 'Google Account' : 'Email & Password';
                authProviderField.value = provider;
            }
            
            // Join date
            if (joinDateField && user.createdAt) {
                const joinDate = new Date(user.createdAt);
                joinDateField.value = joinDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }

        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    window.location.href = '/';
                } else {
                    console.error('Logout failed');
                }
            } catch (error) {
                console.error('Error during logout:', error);
                // Fallback to redirect
                window.location.href = '/';
            }
        }
    </script>
</body>
</html>
